= [[entity_root.anchor]]Розробка та тестування системи "Аеропорт"
:title-page:
Цубін Софія
0.1, 
:short-title: Dev&Test
:toc:
:toclevels: 3
:sectnums:

:url: https://raw.githubusercontent.com/carexoid/se-lab/doc/test/doc/testing/img/

.Історія змін
[width="100%", options="header"]
|=====================================
|Дата|Версія|Опис|Автор

a|8.12.2021
a|0.1
a|Початкове створення
a|Цубін Софія

a|9.12.2021
a|0.2
a|Додано інші види тестувань
a|Цубін Софія

a|9.12.2021
a|0.3
a|Додання опису модульних тестів
a|Гайдученко Ілля

a|9.12.2021
a|0.4
a|Опис результатів розробки Веб-застосунку
a|Цубін Софія

|=====================================

== Результати розробки Веб-застосунку

=== Фінальна архітектура та використані технології

Мiкросервiсна архiтектура, наявнi сервiси:

* Два сервiси бiзнес-логiки, що оперують даними з БД. Імплементовані мовою Python з використанням фреймворку Flask та надбудови Flask Admin. 
* Сервiс оплати для обробки платежiв, транзакцiї відбуваються через платiжну систему Stripe.
* Сервiс аутентифiкацiї оперує даними про користувачiв, що необхiднi для авторизацiї. Авторизація відбувається через JWT, постачальник токенів - GoTrue, віджет авторизації - Netlify. Для розсилки листів підтверждення електронних пошт розгорнуто smtp сервер.

=== Безпека

Доступ до акаунту захищений паролем, використовуються access+refresh токени, відповідно несанкціонований доступ може бути легко деактивований. Всі токени підписуються приватним ключем, неможливо зкомпрометувати токен та дістати інформацію про користувача. Всі приватні ключі, які використовуються сервісами, згенеровані використовуючи криптографічно стійкий генератор випадкових чисел (/dev/urandom). 
Також, надсилання пошти захищене механізмом SPF та DKIM: листи можуть бути надіслані тільки з однієї IP-адреси,  всі листи підписуються приватним ключем, які сервер-приймач верифікує публічним ключем.
Панель адміністрації захищена складним паролем.
З'єднання із сайтом безпечне (HTTPS), використовується TLS-сертифікат, який видав LetsEncrypt.

=== Інтерфейс користувача

Фронтенд імплементований за допомогою фреймворку React та React-бібліотеки компонентів Material-UI.

При розробці інтерфейсу були застосовані як концепції Adaptive Web Design (AWD), так і Responsive Web Design (RWD), однак перевага надавалася AWD.

Також були прийняті до уваги "золоті правила" проектування інтерфейсу. Зокрема: 

* поради щодо валідації форм, формату підказок, розміру полів
* зворотній зв'язок у вигляді Breadcrumbs
* адекватне відображення сайту на різних платформах і пристроях 
* необхідний мінімум об'єктів навігації без переневантажень
* єдиний стиль оформлення сайту та його елементів
* візуальне виділення посилань

Особлива увага була приділена дизайну з точки зору образу аеропорту. Великий красивий банер, музична кнопка-сюрприз, футер - усі ці елементи додані з огляду на це. 

=== Деплой та хостинг Веб-застосунку

Для деплою використовується інструмент microk8s, абсолютно всі сервіси, які відзначені в архітектурі, виконуються ізольовано завдяки Docker та технології контейнерезації. Послідовність деплою:
* розгортаємо базу даних (MySQL);
* створюємо схему airport та gotrue;
* створюємо користувачів бази з різними правами, які представлятимуть відповідні сервіси (chief, admin, gotrue);
* розгортаємо сервіси chief, admin, gotrue, payment;
* розгортаємо smtp сервер;
* для сервісу chief виконуємо flask db init, щоб створити потрібні таблиці, для gotrue ініціалізуємо таблиці командою gotrue migrate;
* опціонально заповнюємо базу аеропорту початковими даними для демонстрації роботи (команда flask db preset в контексті chief);
* очікуємо, поки всі компоненти перейдуть в статус Running;
* запускаємо проксі сервер, який відкриває сервер для "світу";

Веб-застосунок знаходиться за посиланням: https://shlyahdomrii.tech
Панель адміністратора: https://shlyahdomrii.tech/admin

== Модульні тести на підтримку критичного варіанту використання AU1. Придбання або бронювання квитка

[width="100%", options="header"]
|=====================================
|Клас|Метод|Дії для перевірки: «що натиснути,
які дані в які поля ввести»|Очікувана реакція методу
a|
a| verify_token
a| Передати функції токен авторизації
a| Повернення об'єкту User, що пов'язаний з цим токеном. Якщо такий відсутній  --  повернути код *401* (Unauthorized)

a|
a| generate_checkout
a| Передати список білетів, кількість бонусів, номер замовлення та коментар до замовлення
a| Сформувати сторінку оплати замовлення та повернути посилання на неї. Якщо Stripe, через який формується сторінка, недоступний  --  повернути код помилки *500*. Якщо якийсь з параметрів функції в неправильному форматі  --  повернути код помилки *500*.

a|
a| make_order_with_params
a| Передати ідентифікатор користувача, кількість бонусів, список квитків, коментар до замовлення
a| При умові, що в користувача достатньо бонусів на рахунку та квитки вільні для продажу, перенаправити користувача на сторінку оплати замовлення, інакше - повернути код помилки 400 з відповідним текстом помилки (недостатньо бонусів або квиток недоступний). Якщо якийсь з параметрів функції в неправильному форматі  --  повернути код помилки *500*.

a|
a| confirm_order
a| Успішно оплатити замовлення, передати функції номер замовлення та оплачену суму
a| Змінити статус замовлення на завершене та нарахувати користувачу певну кількість бонусів за замовлення. Якщо замовлення з таким номером не існує  --  повернути код помилки *400*.
|=====================================

== Тести функцій Веб-застосунку на підтримку критичного варіанту використання AU1. Придбання або бронювання квитка

Вважаємо, що в тестах, що не перевірють авторизованість користувача, користувач є авторизованим.

.Тести функцій Веб-застосунку на підтримку критичного варіанту використання
[width="100%", options="header"]
|=====================================
|Функція, що перевіряється|Дії для перевірки|Очікувана реакція сайту|On-line інструмент

a|Авторизованість користувача
a|Авторизований користувач натискає кнопку Buy Tickets
a|Відображення інтерфейсу формування замовлення
a|Selenium

a|Авторизованість користувача
a|Неавторизований користувач натискає кнопку Buy Tickets
a|Перехід до сторінки, що повідомляє про необхідність авторизації
a|Selenium

a|Формування замовлення
a|Користувач обирає клас, вводить коректну кількість квитків, натискає кнопку Pay
a|Відображення інтерфейсу для вибору методу оплати
a|Selenium

a|Формування замовлення
a|Користувач вводить некоректну кількість квитків, натискає кнопку Pay
a|Поточний інтерфейс формування замовлення повідомляє про невалідність даних
a|Selenium

a|Вибір способу оплати - онлайн оплата
a|Користувач натискає Pay Online
a|Редірект на сторінку для оплати
a|Selenium

a|Вибір способу оплати - онлайн оплата з бонусами
a|Користувач, що має доступні бонуси, натискає кнопку Pay Online with Bonuses
a|Відображення інтерфейсу для використання бонусів
a|Selenium

a|Вибір способу оплати - онлайн оплата з бонусами
a|Користувач, що не має доступних бонусів, хоче натиснути на кнопку Pay Online with Bonuses
a|Її немає в інтерфейсі
a|Selenium

a|Вибір способу оплати - офлайн оплата
a|Користувач натискає кнопку Pay Offline
a|Перехід на сторінку, що містить інформацію про замовлення
a|Selenium

a|Вибір способу оплати - користувач передумав його вибирати
a|Користувач натискає кнопку Cancel
a|Повернення до інтерфейсу формування замовлення
a|Selenium

a|Вибір способу оплати - помилка
a|Користувач натискає одну з кнопок для оплати
a|Перехід на сторінку, що сповіщає про помилку з можливістю повернутися до формування замовлення 
a|Selenium

a|Використання бонусів
a|Користувач вводить коректну кілкість бонусів та натискає кнопку Pay
a|Редірект на сторінку для оплати
a|Selenium

a|Використання бонусів
a|Користувач вводить некоректну кількість бонусів (від'ємну)
a|Поле автоматично встановить 0
a|Selenium

a|Використання бонусів
a|Користувач вводить некоректну кількість бонусів (пусте значення) та натискає кнопку Pay
a|Пусте поле прирівнюється до 0. Редірект на сторінку для оплати
a|Selenium

a|Використання бонусів
a|Користувач вводить некоректну кількість бонусів (більше доступних або допустимих)
a|Поле автоматично встановить максимальне допустиме значення
a|Selenium

a|Оплата
a|Користувач вводить коретні дані для оплати
a|Підтвердження оплати. Редірект на сторінку з інформацією про замовлення
a|Selenium

a|Помилка оплати
a|Користувач вводить некоретні дані для оплати
a|Сервіс оплати повідомляє про помилку
a|Selenium

a|Помилка оплати
a|Користувач вводить коректні дані
a|Редірект на сторінку з інформацією про помилку
a|Selenium

|=====================================

== Інші види тестування Веб-застосунку

=== Тестування HTML-коду, каскадних таблиць стилів і Java-скриптів

==== HTML-validator

.Валідація головної сторінки
image::{url}html_validator.png[html1]

{nbsp} +

.Валідація сторінки Help
image::{url}html_validator_help.png[html2]

{nbsp} +

.Валідація сторінки перегляду польоту
image::{url}html_validator_view.png[html3]

==== CSS-validator

.Валідація головної сторінки
image::{url}css_validator.png[css1]

{nbsp} +

.Валідація сторінки Help
image::{url}css_validator_help.png[css2]

{nbsp} +

.Валідація сторінки перегляду польоту
image::{url}css_validator_view.png[css3]

На момент проведення тестування була виявлена одна помилка і усунута при наступному деплої сайту. В поточній версії сайту вона вже виправлена.

==== Links-validator

.Валідація головної сторінки
image::{url}links_validator.png[links1]

{nbsp} +

.Валідація сторінки Help
image::{url}links_validator_help.png[links2]

{nbsp} +

.Валідація сторінки перегляду польоту
image::{url}links_validator_view.png[links3]

=== Тестування вигляду Веб-застосунку в популярних браузерах

.Ubuntu 20.04, Firefox
image::{url}ubuntu20_firefox.png[uf]

{nbsp} +

.Ubuntu 20.04, Chrome
image::{url}ubuntu20_chrome.png[uc]

{nbsp} +

.Windows 10, Edge
image::{url}win10_edge.jpg[we]

{nbsp} +

.Windows 10, Firefox
image::{url}win10_firefox.jpg[wf]

{nbsp} +

.Windows 10, Chrome
image::{url}win10_chrome.jpg[wc]

{nbsp} +

.Samsung Galaxy S9+, Android 10, Chrome
image::{url}samsung_chrome.jpg[sac]

{nbsp} +

.iPad Pro 2016, вертикально
image::{url}ipad_v.jpg[iv]

{nbsp} +

.iPad Pro 2016, горизонтально
image::{url}ipad_h.jpg[ih]

На всіх протестованих пристроях та браузерах веб-сайт відображається та функціонує коректно.

=== Навантажувальне тестування, тестування швидкості

==== Швидкість

.Результати тестування швидкості завантаження сторінки, ресурс https://www.webpagetest.org/
image::{url}speed1.jpg[sp]

Перше завантаження триває довго через специфіку обраної технології. SPA додатки не вимагають постійних завантажень наступної сторінки з веб сервера; нові сторінки створюються з одного HTML-документа за допомгою динамічно завантажуваних HTML, CSS, JS-скриптів. Завдяки цьому, коли вже завантажена основна частина, переходи між сторінками швидші.

==== Навантаження

.Результати тестування навантаження, ресурс https://loaddy.com
image::{url}load.jpg[ld]

Отримані результати тестування роботи під навантаженням є задовільними.
